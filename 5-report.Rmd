---
title: "Housing Affordability in Toronto"
subtitle: "Visualizing 2021 Census Data"
author: "Fraser McLaughlin"
contact: 'fraser.mclaughlin@outlook.com'
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_notebook:
    toc: yes
    df_print: paged
    toc_float: yes
    number_sections: yes
    code_folding: hide
    
---
```{css, echo=FALSE}

p.caption {
  font-size: 0.8em;
  font-weight: bold;
}

<!-- h2 { -->
<!--   font-size: 2em; -->
<!-- } -->

.customTable {
  width: 100%;
  border: 1px solid black;
  border-collapse: collapse;
  
.customTable th,
.customTable td {
  width: 20%;
  text-align: left;
  padding: 4px;
  border: 1px solid black;
  border-collapse: collapse;
}
}
```

```{r setup, warning=FALSE, echo=FALSE}
library("pacman")
pacman::p_load(
  tidyverse,
  scales,
  leaflet,
  plotly,
  reactable,
  htmltools,
  htmlwidgets,
  leaflet.extras
)

```


# Introduction

This analysis investigates the spatial distribution of housing affordability in 
Toronto using 2021 census data. This is a work in progress personal interest 
project stemming from the housing crisis we face in the city that I'm from.

The source code for data acquisition, analysis, and this report are 
all [available on GitHub](https://github.com/frasemcl/kensignton-market).

This began as a simple data pull for the 
[Kensington Market Community Land Trust](https://kmclt.ca/), an organization
doing important work, and turned into a deeper dive into the results from our 
most recent census from a Toronto housing affordability perspective.

If I find more time to put into this analysis, there are many more variables that
could be investigated at the Census Tract (CT) level, but I'd really like to look
at changes in the variables shown here over time, understanding that this can be 
tricky given that both census questions and census boundaries change over time. 


# Data

The data for this project are from 

Census tracts (CTs)


For a visual representation of the process of naming the cencsus tracts based
on the neighbourhood that each census tract centroid falls in, see Appendix
section: [Naming Census Tracts](#naming-cts)

## Census Variable Lookup
Use the search bar to search through all 2021 census variables, also called vectors.
Only a few of these variables are currently displayed in the analysis, but any of them 
can easily be added.
```{r, warning=FALSE,echo=FALSE}
table_var_lookup
```

# Visualization
## General Info
### Table

Sort any variable by clicking on the variable name, or try the search bar
```{r, warning=FALSE,echo=FALSE}
table_background_info
```

## Expensive Housing
### Map
**v_CA21_4315:** % of tenant households spending 30% or more of its income on shelter costs\
**v_CA21_4307:** % of owner households spending 30% or more of its income on shelter costs\

**Hover or click CTs, zoom, and toggle between these two choropleth layers in the top right**
```{r, echo=FALSE}
map_leaflet_perc30
```

### Table
**v_CA21_4290:** (households) Spending 30% or more of income on shelter costs\
**v_CA21_4307:** % of owner households spending 30% or more of its income on shelter costs\
**v_CA21_4315:** % of tenant households spending 30% or more of its income on shelter costs\

**Sort any variable by clicking on the variable name, or try the search bar**
```{r, warning=FALSE,echo=FALSE}
table_expensive
```

## Amount of Housing
### Map
**v_CA21_434:** Total Occupied private dwellings by structural type of dwelling data\
**v_CA21_452:** Total Average household size\

**Hover or click CTs, zoom, and toggle between these two choropleth layers in the top right**
```{r, echo=FALSE}
map_leaflet_house_amnt
```

### Table
The first three variables are all very similar, I included them all to help understand what they each represent.

**v_CA21_434:** Total Occupied private dwellings by structural type of dwelling data\
**v_CA21_4288:** Total - Owner and tenant households with household total income greater than zero, in non-farm, non-reserve private dwellings by shelter-cost-to-income ratio\
**v_CA21_4302:** Total - Owner and tenant households with household total income greater than zero and shelter-cost-to-income ratio less than 100%, in non-farm, non-reserve private dwellings\
**v_CA21_452:** Total Average household size\

**Sort any variable by clicking on the variable name, or try the search bar**
```{r, warning=FALSE,echo=FALSE}
table_housing_amt
```

## Housing Cost
### Map
**v_CA21_4309:** Median monthly shelter costs for owned dwellings (\$)\
**v_CA21_4317:** Median monthly shelter costs for rented dwellings (\$)\

**Hover or click CTs, zoom, and toggle between these two choropleth layers in the top right**
```{r, echo=FALSE}
map_leaflet_med_cost
```

### Table
**v_CA21_4309:** Median monthly shelter costs for owned dwellings (\$)\
**v_CA21_4310:** Average monthly shelter costs for owned dwellings (\$)\
**v_CA21_4317:** Median monthly shelter costs for rented dwellings (\$)\
**v_CA21_4318:** Average monthly shelter costs for rented dwellings (\$)\

**Sort any variable by clicking on the variable name, or try the search bar**
```{r, warning=FALSE,echo=FALSE}
table_costs
```



# Appendix
The following visualizations were useful to explore the data, but haven't been
leveraged to add to the narative at this point.

## Interactive Histogram
This interactive plot allows users to explore the distribution of a large number (but not all)
of census variables. To be used alongside the lookup table above.

```{r, out.width = "100%", echo=FALSE}

interactive_histogram
```

## Naming Census Tracts{#naming-cts}

When I began looking at census data on StatsCan's sites and then using Cancensus,
a major pain point was that the census tract names are simply numbers, making them
not at all meaningful! So the first thing that I did was to name the CTs based on
the neighbourhoods that they fall in (there are typically a handful of CTs in a
Toronto neighbourhood). The logic for using centroids came from the [Ontario Community Health Profiles Partnership](https://www.ontariohealthprofiles.ca/resourcesON.php#convfiles), thank you!
```{r, out.width = "100%", echo=FALSE}

# To check, mobile responsiveness is improved now, but to test if out.width
# here is helping or if it was the width var in map_leaflet_perc30 only

map_naming_cts
```

## Other Data Visualizations

Use the 'range slider' below the main plot to focus on range of interest. This plot may be used or adapted in subsequent versions of this analysis. This output can now easily be generated for any variable.

Comparing these two plots is interesting because it is clear, based on the number of
CTs at or above the 40% line for example, that despite the high cost of home ownership, 
renters face much higher housing cost pressures.

```{r, fig.height = 7, out.width = "100%", message = FALSE, echo = FALSE}
v_CA21_4307_plotly_sorted_bar
v_CA21_4315_plotly_sorted_bar
```

## Process Notes
This analysis was done entirely in R, leaning heavily on the Cancensus, Leaflet, 
Tidyverse, and Plotly packages among others, many thanks to all the talented 
open source developers who build and maintain these amazing tools!

This report is written in R markdown and then knit to HTML. The benefit of this


Note that it would be easy to build a Shiny or Dash web application that allows 
the user to display this map for any variable. However, this interactivity would
mean hosting the report online whereas the current document can be saved locally
and shared privately (which in other instances may be desirable). format is that 
although it opens in the browser and has interactivity baked in,
it is also easy to share directly and view offline only. The downside to this
format however is a very large file size compared to a reactive solution using
a server. 

This report was developed for desktop viewing, but it is responsive and looks
good on smaller screens as well.

If you have accessibility concerns, please reach out and I'll make whatever improvements I can.

# Contact

If you have any questions, comments, or feedback, I'm at fraser.mclaughlin@outlook.com.
I specialize in data analysis, visualization and decision making tools. Reach out 
if you'd like to collaborate!

I hope you've found this useful.\
&copy; Fraser McLaughlin 2023\